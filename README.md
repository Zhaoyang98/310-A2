# Interactive psychiatrist chat agent

An interactive psychiatrist chat agent implemented in python. The agent utilizes a parser combinator to parse English syntax and determine the structure of sentences and keywords. This is used to identified what type of sentence the user has provided (*ie.* whether it's a question or statement) and the tone of sentence.

### Features (new features explained at the end of README)

- Interactive conversation
- Sentence grammar parsing
- Understanding mood
- Providing help to user

## Usage 

The bot can be used online at [http://cosc310agent.surge.sh/](http://cosc310agent.surge.sh/) (GUI)

The bot API server is hosted at https://cosc310-bot.herokuapp.com/

***

Requires python 3.8

Prerequisite:

```bash
cd agent

# create virtual envirornment (if not already created)
python3 -m venv venv

# Use virtual envirornment
source venv/bin/activate
```

Run on local machine:

```bash
python3 main.py
```

Run server on `localhost`:

```
flask run
```

Test bot chatting with it another bot:

```
python3 selftalk.py
```

Test bot chatting with another bot on a local socket:

```bash
python3 selftalk.py --local --socket 5000
```

### Client

```bash
cd agent-client
yarn install
yarn start
```

### Test

```bash
python3 -m unittest test
```

## Public Endpoints

*Use to talk to other bots*

Base URL: [https://cosc310-bot.herokuapp.com/](https://cosc310-bot.herokuapp.com/)

#### GET `/agent/<message>`

**returns:** JSON array with the message sent and the response from the bot.

#### POST `/agent/<message>`

**expects:** Flat JSON array of request and response messages in the body of the post request.

**returns:** JSON array modified with the new state from the bot.

The post body should contain the current state of the bot, that is the current conversation. Example data:

```json
['Hello', 'How are you', 'Not bad', 'Good to hear it!']
```

## Modules

- `agent.py`: Primary entry point for running the agent, reads input from user and writes to `stdout`
- `_types.py`: Defines basic types used throughout the source code
- `pcomb.py`: Implementation of a parser combinator, a collection of parsers that convert a stream of characters into tokens.
- `english.py`: Defines grammar for common sentence structures and uses parsers defined in `pcomb.py` to interpret English text.
- `state.py`: Evaluates sentence structure and words generated by english.py to determine how the agent should respond by building a new sentence from dictionaries of keywords.
- `fuzzy.py`: Fuzzy string matching based on leveinshtein distance algorithm.
- `synonyms`: Keyword enlarger based on nltk natural language processing toolkit.

## New Features

- Spell checking:  We use the leveinshtein distance algorithm to perform fuzzy lookup to fix common spelling mistakes.
- Natural language recognition: We use the `nltk` natural language processing toolkit to provide synonyms to improve the conversation variety.
- 2 topics: Depression and PTSD: The bot can recognize two topics and switch between them during the conversation.